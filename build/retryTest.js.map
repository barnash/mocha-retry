{"version":3,"sources":["../source/retryTest.js"],"names":[],"mappings":"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","file":"retryTest.js","sourcesContent":["\"use strict\";\n\nimport {Runnable} from \"mocha\";\n\nfunction RetryTest(times, title, fn) {\n\tRunnable.call(this, title, fn);\n\tthis.times = times;\n\tthis.pending = !fn;\n\tthis.type = \"test\";\n}\n\nRetryTest.prototype.run = function (fn) {\n\tvar done, emitted, finished, multiple, runTimes;\n\tfinished = emitted = void 0;\n\trunTimes = 1;\n\tmultiple = (function (_this) {\n\t\treturn function (err) {\n\t\t\tif (emitted) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\temitted = true;\n\t\t\treturn _this.emit(\"error\", err || new Error(\"done() called multiple times\"));\n\t\t};\n\t})(this);\n\tdone = (function (_this) {\n\t\treturn function (err) {\n\t\t\tvar start;\n\t\t\tif (_this.timedOut) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (finished) {\n\t\t\t\treturn multiple(err);\n\t\t\t}\n\t\t\tif ((err != null) && runTimes !== _this.times) {\n\t\t\t\trunTimes++;\n\t\t\t\tstart = new Date;\n\t\t\t\treturn _this._run(fn, done);\n\t\t\t}\n\t\t\t_this.clearTimeout();\n\t\t\t_this.duration = new Date - start;\n\t\t\tfinished = true;\n\t\t\treturn fn(err);\n\t\t};\n\t})(this);\n\treturn this._run(fn, done);\n};\n\nRetryTest.prototype._run = function (fn, done) {\n\tthis.timeout();\n\tconst ctx = this.ctx;\n\tif (ctx) {\n\t\tctx.runnable(this);\n\t}\n\tthis.callback = done;\n\tif (this.async) {\n\t\tthis.resetTimeout();\n\t\ttry {\n\t\t\tthis.fn.call(ctx, (err) => {\n\t\t\t\tif (err instanceof Error || toString.call(err) === \"[object Error]\") {\n\t\t\t\t\treturn done(err);\n\t\t\t\t}\n\t\t\t\tif (err) {\n\t\t\t\t\treturn done(new Error(\"done() invoked with non-Error: \" + err));\n\t\t\t\t}\n\t\t\t\treturn done();\n\t\t\t});\n\t\t} catch (error) {\n\t\t\tdone(error);\n\t\t}\n\t\treturn;\n\t}\n\tif (this.asyncOnly) {\n\t\tdone(new Error(\"--async-only option in use without declaring `done()`\"));\n\t\treturn;\n\t}\n\tconst callFn = (function (_this) {\n\t\treturn function (fn) {\n\t\t\tvar result;\n\t\t\tresult = fn.call(ctx);\n\t\t\tif (result && typeof result.then === \"function\") {\n\t\t\t\t_this.resetTimeout();\n\t\t\t\treturn result.then((function () {\n\t\t\t\t\treturn done();\n\t\t\t\t}), done);\n\t\t\t} else {\n\t\t\t\treturn done();\n\t\t\t}\n\t\t};\n\t})(this);\n\ttry {\n\t\tif (this.pending) {\n\t\t\treturn done();\n\t\t} else {\n\t\t\treturn callFn(this.fn);\n\t\t}\n\t} catch (error1) {\n\t\treturn done(error1);\n\t}\n};\n\nRetryTest.prototype.__proto__ = Runnable.prototype;\n\nexport default RetryTest;\n"]}