{"version":3,"sources":["../source/bddRetryInterface.js"],"names":[],"mappings":"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","file":"bddRetryInterface.js","sourcesContent":["\"use strict\";\n\nimport RetryTest from \"./retryTest\";\nimport RetrySuite from \"./retrySuite\";\nimport {normalize} from \"./utils\";\nimport escapeStringRegexp from \"escape-string-regexp\";\n\n\nexport default function createInterface() {\n\n\treturn (suite) => {\n\t\tconst suites = [suite];\n\t\tsuite.on(\"pre-require\", (context, file, mocha) => {\n\t\t\tcontext.before = (...args) => RetrySuite.prototype.beforeAllWithRetry.bind(suites[0])(...args);\n\t\t\tcontext.after = (...args) => RetrySuite.prototype.afterAllWithRetry.bind(suites[0])(...args);\n\t\t\tcontext.beforeEach = (...args) => RetrySuite.prototype.beforeEachWithRetry.bind(suites[0])(...args);\n\t\t\tcontext.afterEach = (...args) => RetrySuite.prototype.afterEachWithRetry.bind(suites[0])(...args);\n\t\t\tcontext.describe = context.context = (...args) => {\n\t\t\t\tconst {times, title, fn} = normalize(suites[0].times, ...args);\n\t\t\t\tconst asuite = RetrySuite.create(suites[0], title);\n\t\t\t\tasuite.times = times || ~~process.env.MOCHA_RETRY;\n\t\t\t\tasuite.file = file;\n\t\t\t\tsuites.unshift(asuite);\n\t\t\t\tfn.call(asuite);\n\t\t\t\tsuites.shift();\n\t\t\t\treturn asuite;\n\t\t\t};\n\t\t\tcontext.xdescribe = context.xcontext = context.describe.skip = (...args) => {\n\t\t\t\tconst {title, fn} = normalize(0, ...args);\n\t\t\t\tconst asuite = RetrySuite.create(suites[0], title);\n\t\t\t\tasuite.pending = true;\n\t\t\t\tsuites.unshift(asuite);\n\t\t\t\tfn.call(asuite);\n\t\t\t\treturn suites.shift();\n\t\t\t};\n\t\t\tcontext.describe.only = (...args) => {\n\t\t\t\tconst asuite = context.describe(...args);\n\t\t\t\tmocha.grep(asuite.fullTitle());\n\t\t\t\treturn asuite;\n\t\t\t};\n\t\t\tcontext.it = context.itretry = (...args) => {\n\t\t\t\tconst asuite = suites[0];\n\t\t\t\tconst {times, title, fn} = normalize(asuite.times || 1, ...args);\n\t\t\t\tconst test = new RetryTest(times, title, asuite.pending ? null : fn);\n\t\t\t\ttest.file = file;\n\t\t\t\ttest.suite = asuite;\n\t\t\t\tasuite.addTest(test);\n\t\t\t\treturn test;\n\t\t\t};\n\t\t\tcontext.it.only = (...args) => {\n\t\t\t\tconst asuite = suites[0];\n\t\t\t\tconst {times, title, fn} = normalize(asuite.times || 1, ...args);\n\t\t\t\tconst test = context.it(process.env.MOCHA_IT_ONLY_ONCE === \"true\" ? 1 : times, title, fn);\n\t\t\t\tconst reString = \"^\" + escapeStringRegexp(test.fullTitle()) + \"$\";\n\t\t\t\tmocha.grep(new RegExp(reString));\n\t\t\t\treturn test;\n\t\t\t};\n\t\t\tcontext.xit = context.xspecify = context.it.skip = (...args) => {\n\t\t\t\tconst {title} = normalize(0, ...args);\n\t\t\t\treturn context.it(1, title);\n\t\t\t};\n\t\t});\n\t};\n}\n"]}