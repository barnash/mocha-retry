{"version":3,"sources":["../source/retryHook.js"],"names":[],"mappings":"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","file":"retryHook.js","sourcesContent":["// Generated by CoffeeScript 1.10.0\n(function() {\n  var RetryHook, Runnable;\n\n  RetryHook = function(times, title, fn) {\n    Runnable.call(this, title, fn);\n    this.times = times || 1;\n    return this.type = \"hook\";\n  };\n\n  RetryHook.prototype.error = function(err) {\n    if (arguments.length === 0) {\n      err = this._error;\n      this._error = null;\n      return err;\n    }\n    return this._error = err;\n  };\n\n  RetryHook.prototype.run = function(fn) {\n    var done, emitted, finished, multiple, runTimes, start;\n    finished = emitted = void 0;\n    runTimes = 1;\n    multiple = (function(_this) {\n      return function(err) {\n        if (emitted) {\n          return;\n        }\n        emitted = true;\n        return _this.emit(\"error\", err || new Error(\"done() called multiple times\"));\n      };\n    })(this);\n    done = (function(_this) {\n      return function(err) {\n        var start;\n        if (_this.timedOut) {\n          return;\n        }\n        if (finished) {\n          return multiple(err);\n        }\n        if ((err != null) && runTimes !== _this.times) {\n          runTimes++;\n          start = new Date;\n          return _this._run(fn, done);\n        }\n        _this.clearTimeout();\n        _this.duration = new Date - start;\n        finished = true;\n        return fn(err);\n      };\n    })(this);\n    start = new Date;\n    return this._run(fn, done);\n  };\n\n  RetryHook.prototype._run = function(fn, done) {\n    var callFn, ctx, err, error, error1, ms;\n    ms = this.timeout();\n    ctx = this.ctx;\n    if (ctx) {\n      ctx.runnable(this);\n    }\n    this.callback = done;\n    if (this.async) {\n      this.resetTimeout();\n      try {\n        this.fn.call(ctx, function(err) {\n          if (err instanceof Error || toString.call(err) === \"[object Error]\") {\n            return done(err);\n          }\n          if (err != null) {\n            return done(new Error(\"done() invoked with non-Error: \" + err));\n          }\n          return done();\n        });\n      } catch (error) {\n        err = error;\n        done(err);\n      }\n      return;\n    }\n    if (this.asyncOnly) {\n      return done(new Error(\"--async-only option in use without declaring `done()`\"));\n    }\n    callFn = (function(_this) {\n      return function(fn) {\n        var result;\n        result = fn.call(ctx);\n        if (result && typeof result.then === \"function\") {\n          _this.resetTimeout();\n          return result.then((function() {\n            return done();\n          }), done);\n        } else {\n          return done();\n        }\n      };\n    })(this);\n    try {\n      if (this.pending) {\n        return done();\n      } else {\n        return callFn(this.fn);\n      }\n    } catch (error1) {\n      err = error1;\n      return done(err);\n    }\n  };\n\n  Runnable = require(\"mocha\").Runnable;\n\n  RetryHook.prototype.__proto__ = Runnable.prototype;\n\n  module.exports = RetryHook;\n\n}).call(this);\n"]}